<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Factory Planet - Production Stats</title>
    <style>
        :root { 
            --bg: #0f0f0f; --panel: #1a1a1a; --accent: #ff9800; 
            --iron: #3d3d3d; --copper: #5d2a1c; --quartz: #004d40; --oil: #111;
            --power: #4caf50; --danger: #f44336; --energy: #ffeb3b;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; overflow: hidden; display: flex; height: 100vh; }
        #left-panel { width: 140px; background: var(--panel); border-right: 1px solid #333; display: flex; flex-direction: column; gap: 5px; padding: 10px; overflow-y: auto; flex-shrink: 0; }
        #game-area { flex-grow: 1; position: relative; display: flex; flex-direction: column; overflow: hidden; }
        #right-panel { width: 180px; background: var(--panel); border-left: 1px solid #333; padding: 10px; overflow-y: auto; flex-shrink: 0; }
        #hud { background: rgba(0,0,0,0.9); padding: 10px; border-bottom: 1px solid #333; }
        .res-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; font-size: 10px; margin-bottom: 8px; }
        .res-item { background: #222; padding: 2px 4px; border-radius: 2px; border: 1px solid #333; display: flex; justify-content: space-between; }
        .prod-stat { font-size: 8px; font-weight: bold; margin-left: 4px; }
        .plus { color: #4caf50; } .minus { color: #f44336; }
        #power-container { background: #000; border: 1px solid #333; height: 18px; position: relative; border-radius: 4px; }
        #power-fill { background: var(--energy); height: 100%; width: 0%; transition: width 0.3s; }
        #power-text { position: absolute; width: 100%; text-align: center; font-size: 10px; top: 2px; font-weight: bold; color: white; text-shadow: 1px 1px black; }
        #viewport { flex-grow: 1; overflow: auto; display: flex; align-items: center; justify-content: center; background: #080808; padding: 20px; }
        #grid { display: grid; grid-template-columns: repeat(45, 35px); grid-template-rows: repeat(22, 35px); gap: 1px; }
        .cell { width: 35px; height: 35px; background: #141414; border: 1px solid #1f1f1f; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; }
        .cell.iron { background: var(--iron); } .cell.copper { background: var(--copper); } 
        .cell.quartz { background: var(--quartz); } .cell.oil { background: var(--oil); }
        .cell.impact { background-color: var(--danger) !important; animation: shake 0.2s infinite; }
        .build-btn { background: #2a2a2a; color: white; border: 1px solid #444; padding: 6px; border-radius: 4px; font-size: 10px; cursor: pointer; text-align: left; }
        .build-btn span { display: block; font-size: 8px; color: #888; }
        .build-btn.active { border-color: var(--accent); background: #3d2a00; }
        .tech-item { background: #222; border: 1px solid #444; padding: 10px; border-radius: 6px; margin-bottom: 12px; font-size: 11px; }
        .tech-item.current { border: 1px solid var(--accent); background: #2a2010; }
        .tech-item.unlocked { border: 1px solid var(--power); opacity: 0.6; }
        .tech-btn { width: 100%; background: var(--accent); border: none; padding: 6px; margin-top: 8px; font-weight: bold; cursor: pointer; border-radius: 3px; }
        @keyframes shake { 0% { transform: translate(1px); } 100% { transform: translate(-1px); } }
        #alert { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: var(--danger); color: white; padding: 15px; z-index: 1000; display: none; font-weight: bold; border-radius: 5px; }
        .night-mode #viewport { filter: brightness(0.4); }
    </style>
</head>
<body id="main-body">

<div id="alert">‚ö†Ô∏è M√âT√âORE EN APPROCHE ! ‚ö†Ô∏è</div>

<div id="left-panel">
    <h3 style="font-size:11px; color:var(--accent);">üî® B√ÇTIMENTS</h3>
    <button class="build-btn" id="btn-solar" onclick="setMode('solar')">‚òÄÔ∏è Solaire <span>40Fe, 20Cu</span></button>
    <button class="build-btn" id="btn-battery_block" onclick="setMode('battery_block')">üóÑÔ∏è Stockage <span>50Fe, 20Bat</span></button>
    <button class="build-btn" id="btn-miner" onclick="setMode('miner')">‚õèÔ∏è Mineur <span>50Fe</span></button>
    <button class="build-btn" id="btn-glass_factory" onclick="setMode('glass_factory')">üè∫ Verre <span>80Fe, 40Qz</span></button>
    <button class="build-btn" id="btn-plastic_factory" onclick="setMode('plastic_factory')">üß™ Plastique <span>100Fe, 50Oil</span></button>
    <button class="build-btn" id="btn-cable_factory" onclick="setMode('cable_factory')">üîå C√¢ble <span>60Fe, 40Cu</span></button>
    <button class="build-btn" id="btn-motor_factory" onclick="setMode('motor_factory')">‚öôÔ∏è Moteur <span>120Fe, 60Cu</span></button>
    <button class="build-btn" id="btn-battery_factory" onclick="setMode('battery_factory')">üîã Batterie <span>150Fe, 50Cu</span></button>
    <button class="build-btn" id="btn-robot_factory" onclick="setMode('robot_factory')">ü§ñ Robot <span>Mot+Cab+Pla</span></button>
    <button class="build-btn" id="btn-rocket_factory" onclick="setMode('rocket_factory')">üöÄ Fus√©e <span>Bat+Mot+Rob</span></button>
    <button class="build-btn" onclick="setMode('recycle')" id="btn-recycle" style="color:var(--danger); margin-top:10px;">‚ôªÔ∏è D√âMOLIR</button>
</div>

<div id="game-area">
    <div id="hud">
        <div class="res-grid" id="res-display"></div>
        <div id="power-container">
            <div id="power-fill"></div>
            <div id="power-text">STOCK: 0 / 0 | CONS: 0W | PROD: 0W</div>
        </div>
        <div id="time-display" style="font-size: 11px; text-align: center; margin-top: 5px;">‚òÄÔ∏è JOUR</div>
    </div>
    <div id="viewport"><div id="grid"></div></div>
</div>

<div id="right-panel">
    <h3 style="font-size:11px; color:var(--accent);">üöÄ TIERS</h3>
    <div id="tier-list"></div>
</div>

<script>
    let state = {
        res: { iron: 500, copper: 200, quartz: 100, oil: 50, glass: 0, plastic: 0, cable: 0, motor: 0, battery: 0, robot: 0, rocket: 0 },
        energy: 0, maxEnergy: 0, tier: 1, mode: null, time: 0
    };

    const TECHS = [
        { id: 1, name: "Base", bonus: "x1", cost: {} },
        { id: 2, name: "Industrie", bonus: "x1.5", cost: { iron: 1000, copper: 300 } },
        { id: 3, name: "√âlectronique", bonus: "x2.5", cost: { glass: 200, cable: 200 } },
        { id: 4, name: "√àre Spatiale", bonus: "x5", cost: { iron: 10000, motor: 300 } }
    ];

    const COSTS = {
        solar: { iron: 40, copper: 20 }, battery_block: { iron: 50, battery: 20 },
        miner: { iron: 50 }, glass_factory: { iron: 80, quartz: 40 }, plastic_factory: { iron: 100 },
        cable_factory: { iron: 60, copper: 40 }, motor_factory: { iron: 120, copper: 60 },
        battery_factory: { iron: 150, copper: 50 }, robot_factory: { motor: 10 }, rocket_factory: { iron: 500 }
    };

    let gridData = [];
    const COLS = 45, ROWS = 22;

    function init() {
        const gridEl = document.getElementById('grid');
        for (let i = 0; i < COLS * ROWS; i++) {
            let r = Math.random();
            let type = (r > 0.98) ? 'oil' : (r > 0.96) ? 'quartz' : (r > 0.93) ? 'copper' : (r > 0.88) ? 'iron' : 'empty';
            gridData.push({ id: i, type, build: null, deadUntil: 0 });
            let cell = document.createElement('div');
            cell.className = `cell ${type}`; cell.id = 'c-' + i;
            cell.onclick = () => handleCellClick(i);
            gridEl.appendChild(cell);
        }
        updateTierUI();
        setInterval(spawnMeteor, 120000);
    }

    function spawnMeteor() {
        document.getElementById('alert').style.display = 'block';
        setTimeout(() => {
            document.getElementById('alert').style.display = 'none';
            const center = Math.floor(Math.random() * (COLS * ROWS));
            [center, center+1, center+COLS, center-COLS].forEach(idx => {
                if(gridData[idx]) { gridData[idx].build = null; gridData[idx].deadUntil = Date.now() + 30000; }
            });
        }, 3000);
    }

    function handleCellClick(i) {
        if(Date.now() < gridData[i].deadUntil) return;
        if (state.mode === 'recycle') { gridData[i].build = null; return; }
        if (gridData[i].build || !state.mode) return;
        let cost = COSTS[state.mode];
        if (cost && Object.keys(cost).every(r => state.res[r] >= cost[r])) {
            Object.keys(cost).forEach(r => state.res[r] -= cost[r]);
            gridData[i].build = state.mode;
        }
    }

    function setMode(m) {
        state.mode = (state.mode === m) ? null : m;
        document.querySelectorAll('.build-btn').forEach(b => b.classList.remove('active'));
        if(state.mode) document.getElementById('btn-' + m).classList.add('active');
    }

    function updateTierUI() {
        const list = document.getElementById('tier-list');
        list.innerHTML = "";
        TECHS.forEach(t => {
            let div = document.createElement('div');
            div.className = `tech-item ${state.tier === t.id ? 'current' : ''} ${state.tier > t.id ? 'unlocked' : ''}`;
            let canAfford = Object.entries(t.cost).every(([r, v]) => state.res[r] >= v);
            div.innerHTML = `<b>TIER ${t.id}</b><br><small>${t.bonus}</small><br>`;
            Object.entries(t.cost).forEach(([r,v]) => { div.innerHTML += `<div style="font-size:9px">‚Ä¢ ${v} ${r}</div>`; });
            if(state.tier === t.id - 1) {
                let btn = document.createElement('button'); btn.className="tech-btn"; btn.innerText="D√âBLOQUER";
                btn.disabled = !canAfford; btn.onclick = () => { Object.entries(t.cost).forEach(([r,v])=>state.res[r]-=v); state.tier=t.id; updateTierUI(); };
                div.appendChild(btn);
            }
            list.appendChild(div);
        });
    }

    setInterval(() => {
        state.time = (state.time + 1) % 60;
        const isNight = state.time >= 30;
        document.getElementById('main-body').className = isNight ? 'night-mode' : '';
        document.getElementById('time-display').innerText = isNight ? 'üåô NUIT' : '‚òÄÔ∏è JOUR';

        let prod = gridData.filter(c => c.build === 'solar').length * (isNight ? 2 : 15);
        state.maxEnergy = gridData.filter(c => c.build === 'battery_block').length * 10;
        
        let cons = 0;
        gridData.forEach(c => {
            if(!c.build || Date.now() < c.deadUntil) return;
            const pMap = { miner:8, glass_factory:10, plastic_factory:12, cable_factory:8, motor_factory:15, battery_factory:20, robot_factory:40, rocket_factory:100 };
            if(pMap[c.build]) cons += pMap[c.build];
        });

        state.energy = Math.max(0, Math.min(state.maxEnergy, state.energy + (prod - cons)));
        let hasPower = (prod - cons >= 0 || state.energy > 0);

        const mult = {1:1, 2:1.5, 3:2.5, 4:5}[state.tier];
        let diff = { iron: 0, copper: 0, quartz: 0, oil: 0, glass: 0, plastic: 0, cable: 0, motor: 0, battery: 0, robot: 0, rocket: 0 };

        gridData.forEach((c, idx) => {
            const el = document.getElementById('c-' + idx);
            const isDead = Date.now() < c.deadUntil;
            el.className = `cell ${c.type} ${isDead ? 'impact' : ''}`;
            const icons = { solar:'‚òÄÔ∏è', battery_block:'üóÑÔ∏è', miner:'‚õèÔ∏è', glass_factory:'üè∫', plastic_factory:'üß™', motor_factory:'‚öôÔ∏è', cable_factory:'üîå', battery_factory:'üîã', robot_factory:'ü§ñ', rocket_factory:'üöÄ' };
            el.innerHTML = c.build ? icons[c.build] : (isDead ? 'üî•' : '');

            if(c.build && !isDead && hasPower) {
                if(c.build === 'miner') { state.res[c.type] += mult; diff[c.type] += mult; }
                if(c.build === 'glass_factory' && state.res.quartz >= 1) { state.res.quartz--; diff.quartz--; state.res.glass += mult; diff.glass += mult; }
                if(c.build === 'plastic_factory' && state.res.oil >= 1) { state.res.oil--; diff.oil--; state.res.plastic += mult; diff.plastic += mult; }
                if(c.build === 'motor_factory' && state.res.iron >= 1 && state.res.copper >= 1) { state.res.iron--; state.res.copper--; diff.iron--; diff.copper--; state.res.motor += mult; diff.motor += mult; }
                if(c.build === 'cable_factory' && state.res.copper >= 1) { state.res.copper--; diff.copper--; state.res.cable += mult; diff.cable += mult; }
                if(c.build === 'battery_factory' && state.res.iron >= 2 && state.res.copper >= 1 && state.res.cable >= 1) { state.res.iron-=2; state.res.copper--; state.res.cable--; diff.iron-=2; diff.copper--; diff.cable--; state.res.battery += mult; diff.battery += mult; }
                if(c.build === 'robot_factory' && state.res.motor >= 3 && state.res.cable >= 5 && state.res.plastic >= 2) { state.res.motor-=3; state.res.cable-=5; state.res.plastic-=2; diff.motor-=3; diff.cable-=5; diff.plastic-=2; state.res.robot += mult; diff.robot += mult; }
                if(c.build === 'rocket_factory' && state.res.battery >= 3 && state.res.motor >= 3 && state.res.robot >= 2) { state.res.battery-=3; state.res.motor-=3; state.res.robot-=2; diff.battery-=3; diff.motor-=3; diff.robot-=2; state.res.rocket += mult; diff.rocket += mult; }
            }
        });

        const resDiv = document.getElementById('res-display');
        resDiv.innerHTML = Object.entries(state.res).map(([k,v]) => {
            let d = diff[k];
            let dText = d >= 0 ? `<span class="prod-stat plus">+${d}</span>` : `<span class="prod-stat minus">${d}</span>`;
            return `<div class="res-item"><span>${k.toUpperCase().slice(0,3)}: ${Math.floor(v)}</span>${dText}</div>`;
        }).join('');
        
        document.getElementById('power-fill').style.width = (state.maxEnergy > 0 ? (state.energy/state.maxEnergy)*100 : 0) + '%';
        document.getElementById('power-text').innerText = `STOCK: ${Math.floor(state.energy)}/${state.maxEnergy} | CONS: ${cons}W | PROD: ${prod}W`;
        updateTierUI();
    }, 1000);

    init();
</script>
</body>
</html>
